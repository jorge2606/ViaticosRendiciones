<a 
    placement="bottom" 
    ngbTooltip="Volver al listado de usuarios" 
    class="btn btn-primary mb-1 ml-2" href="" routerLink="/users">
    <fa-icon class="fa-lg" icon="arrow-left"></fa-icon>    
</a>

<ngb-tabset #t="ngbTabset" (tabChange)="setTitleTab()">
    <ngb-tab id="tab-selectbyid1">
        <ng-template ngbTabTitle><span >Perfil</span></ng-template>
        <ng-template ngbTabContent>
            <div class="container col-5 mt-1">

                <div class="card">
                        <h5 class="card-header">Modificar</h5>
                    <div class="card-body">

                        <form (ngSubmit)="onSubmit()" #userForm="ngForm">
                                <div class="form-row mb-1">
                                    <div class="col-6">
                                        <input 
                                        class="form-control" 
                                        [(ngModel)]="model.dni" 
                                        #dni="ngModel" 
                                        name="Dni"  
                                        type="number"
                                        placeholder="Dni" 
                                        mask='00-00000000-0'
                                        [showMaskTyped] = "true"
                                        type='text' 
                                        required>
                                    </div>
                                </div>
                            
                                <div style="margin-top: 10px;" 
                                *ngIf="dni.dirty && !submitted && dni.invalid" 
                                class="alert alert-danger">
                                    <div *ngIf="dni.errors.required">
                                        El campo 'Dni' no debería estar vacío
                                    </div>
                                </div>
                            
                                    <div class="form-group mb-1">
                                        <input class="form-control" 
                                            [(ngModel)]="model.firstName" 
                                            #firstName="ngModel" 
                                            required name="firstName" 
                                            type="text"
                                            placeholder="Nombre">
                                    </div>
                            
                                    <div *ngIf="submitted && firstName.invalid" clas="alert alert-danger mt-1">
                                            Nombre Incorrecto
                                    </div>
                            
                                    <div class="form-group mb-1">
                                        <input class="form-control" 
                                            [(ngModel)]="model.lastName" 
                                            #lastName="ngModel" 
                                            required name="lastName" 
                                            type="text"
                                            placeholder="Apellido">
                                    </div>
                            
                                    <div *ngIf="submitted && lastName.invalid" clas="alert alert-danger mt-1">
                                            Apellido Incorrecto
                                    </div>
                        
                                <div class="form-group mb-1">
                                    <input class="form-control" 
                                            [(ngModel)]="model.userName" 
                                            required 
                                            #Usuario="ngModel" 
                                            name="Usuario" 
                                            type="text"
                                            placeholder="Correo electrónico" disabled>
                                </div>
                        
                                <div *ngIf="submitted && Usuario.invalid" class="alert alert-danger mt-1">
                                    Usuario Incorrecto
                                </div>
                        
                                <div class="form-group mb-1">
                                    <input 
                                        class="form-control" 
                                        #password="ngModel" 
                                        name="password" 
                                        (keyup)="comparePassword()"
                                        [(ngModel)]="model.password" 
                                        [ngClass]="{
                                            'is-invalid' : !passwordsAreEquals && !passwordEmpty ,
                                            'is-valid' : passwordsAreEquals && !passwordEmpty
                                        }"
                                        type="password"
                                        placeholder="Nueva Contraseña" 
                                        value="">
                                </div>

                                <div style="margin-bottom:5px;" class="form-group">
                                    <input 
                                        class="form-control"
                                        (keyup)="comparePassword()" 
                                        [(ngModel)]="model.repeatPassword" 
                                        [ngClass]="{
                                            'is-invalid' : !passwordsAreEquals && !passwordEmpty ,
                                            'is-valid' : passwordsAreEquals && !passwordEmpty
                                        }"
                                        #repeatPassword="ngModel" 
                                        name="repeatPassword" 
                                        type="password"
                                        placeholder="Repetir Contraseña" 
                                        value="">
                                </div>

                                <div class="form-group mb-0">
                                    <div class="form-row ml-0">
                                        <div *ngFor="let rol of model.rolesUser" class="custom-control custom-checkbox mr-2">
                                            <input name="{{rol.id}}" 
                                                value="{{rol.id}}" 
                                                [(ngModel)]="rol.rolBelongUser" 
                                                (click)="changeStateCheckbox(rol)"
                                                [ngClass]="{'is-invalid' : !validCheckbox}"
                                                type="checkbox" 
                                                class="custom-control-input" 
                                                id="customControlValidation{{rol.id}}" 
                                                >
                                            <label class="custom-control-label" for="customControlValidation{{rol.id}}">{{rol.name}}</label>
                                        </div>
                                    </div>
                                </div> 
                        
                                <div class="form-group mb-1">
                                    <input class="form-control" [(ngModel)]="model.phoneNumber" required #PhoneNumber="ngModel" name="phoneNumber"
                                        type="text" placeholder="Telefóno" value="">
                                </div>
                                
                                <div *ngIf="submitted && PhoneNumber.invalid" class="alert alert-danger mt-1">
                                    Telefóno Incorrecto
                                </div>

                                <div class="form-group mb-1">    
                                    <select class="form-control" #distributionId="ngModel" name="distributionId" [(ngModel)]="model.distributionId">
                                        <option *ngIf="selectedDistributionId == model.distributionId" [ngValue]="selectedDistributionId" disabled>
                                            Seleccione una Distribución...
                                        </option>
                                        <option *ngFor="let dist of distribution" value="{{dist.id}}">{{dist.name}}</option>
                                    </select>
                                </div>

                                <div class="form-group mb-1">
                                    <select class="form-control" #categoryId="ngModel" name="categoryId" [(ngModel)]="model.categoryId">
                                        <option *ngFor="let cat of categories" [ngValue]="cat.id">{{cat.name}} - {{cat.description}}</option>
                                    </select>
                                </div>
                        
                                <div class="form-row mb-1">
                                        <button placement="top" ngbTooltip="Enviar este formulario" 
                                            class="btn btn-success ml-auto" [disabled]="!userForm.form.valid">
                                            <fa-icon class="fa-lg" icon="save"></fa-icon> Guardar
                                        </button>
                                </div>
                        
                        </form>

                    </div>
                </div>

                <div class="alert alert-danger mt-1" *ngIf="userForm.form.invalid">
                    Hay campos erroneos en el formulario, verifiquelos
                </div>
            </div>
        </ng-template>
    </ngb-tab>
    <ngb-tab>
        <ng-template ngbTabTitle>Auditoría</ng-template>
        <ng-template ngbTabContent>
            <app-audit-users [userId]="id"></app-audit-users>
        </ng-template>
    </ngb-tab>
    <ngb-tab>
            <ng-template ngbTabTitle>Auditoría-Notificaciones</ng-template>
            <ng-template ngbTabContent>
                <app-audit-notification [userId]="id"></app-audit-notification>
            </ng-template>
    </ngb-tab>
    <ngb-tab *ngIf="editSignatureHolograpich">
        <ng-template ngbTabTitle>Firma Hológrafa</ng-template>
        <ng-template ngbTabContent>
            <div class="container col-md-4">
                <app-holograph-sign [supervisorId]="id"></app-holograph-sign>
            </div>
        </ng-template>
    </ngb-tab>
</ngb-tabset>